\label{ch:radiation}

\section{Equations of Radiation Hydrodynamics}

\subsection{Reference Frames}

\subsection{Angular Approximations / Moments}

\subsection{Closures}



\section{Hyperbolic System}



\section{Parabolic System}

\subsection{General Elliptic Solver}

For the gray radiation hydrodynamics system, we need to solve a
linear system that takes the form:
\begin{equation}
  \alpha \phi + \nabla \cdot \beta \nabla \phi + \gamma \cdot \nabla \phi = f
\end{equation}
(see Zhang et al., Eq. 45). 
We can discretize this for a cell-centered $\phi$ to second-order as:
\begin{align}
  \alpha_{i,j} \phi_{i,j} &+
  \frac{(\beta \nabla \phi)_{i+1/2,j} -
        (\beta \nabla \phi)_{i-1/2,j}}{\Delta x} +
  \frac{(\beta \nabla \phi)_{i,j+1/2} -
        (\beta \nabla \phi)_{i,j-1/2}}{\Delta y} \nonumber \\
  &+
  \gamma^{(x)}_{i,j} \frac{\phi_{i+1,j} - \phi_{i-1,j}}{2\Delta x} +
  \gamma^{(y)}_{i,j} \frac{\phi_{i,j+1} - \phi_{i,j-1}}{2\Delta y} = f_{i,j}
\end{align}
where we decompose the vector, $\gamma$ as $\gamma = \gamma^{(x)}\hat{x} + \gamma^{(y)}\hat{y}$.  Expanding the gradients:
\begin{align}
\label{eq:general_L}
\alpha_{i,j} \phi_{i,j} &+
  \frac{\beta_{i+1/2,j} (\phi_{i+1,j} - \phi_{i,j}) -
        \beta_{i-1/2,j} (\phi_{i,j} - \phi_{i-1,j})}{\Delta x^2} \nonumber \\
 &+
  \frac{\beta_{i,j+1/2} (\phi_{i,j+1} - \phi_{i,j}) -
        \beta_{i,j-1/2} (\phi_{i,j} - \phi_{i,j-1})}{\Delta y^2} \nonumber \\
  &+
  \gamma^{(x)}_{i,j} \frac{\phi_{i+1,j} - \phi_{i-1,j}}{2\Delta x} +
  \gamma^{(y)}_{i,j} \frac{\phi_{i,j+1} - \phi_{i,j-1}}{2\Delta y} = f_{i,j}
\end{align}
Defining $\tilde{\beta}_{i\pm1/2,j} \equiv \beta_{i\pm1/2,j}/\Delta x^2$,
$\tilde{\beta}_{i,j\pm1/2} \equiv \beta_{i,j\pm1/2}/\Delta y^2$,
$\tilde{\gamma}^{(x)}_{i,j} = \gamma^{(x)}_{i,j}/(2\Delta x)$,
and $\tilde{\gamma}^{(y)}_{i,j} = \gamma^{(y)}_{i,j}/(2\Delta y)$, we have
as an update to $\phi_{i,j}$,
\begin{align}
\label{eq:general_mg_smooth}
\phi_{i,j} = \frac{1}{D_{i,j}} \bigg [ f_{i,j}
  &-(\tilde{\beta}_{i+1/2,j} + \tilde{\gamma}^{(x)}_{i,j}) \phi_{i+1,j}
   -(\tilde{\beta}_{i-1/2,j} - \tilde{\gamma}^{(x)}_{i,j}) \phi_{i-1,j}
  \nonumber \\
  &-(\tilde{\beta}_{i,j+1/2} + \tilde{\gamma}^{(y)}_{i,j}) \phi_{i,j+1}
   -(\tilde{\beta}_{i,j-1/2} - \tilde{\gamma}^{(y)}_{i,j}) \phi_{i,j-1}
   \bigg ]
\end{align}
with
\begin{equation}
D_{i,j} = \alpha_{i,j} - \tilde{\beta}_{i+1/2,j} - \tilde{\beta}_{i-1/2,j}
                       - \tilde{\beta}_{i,j+1/2} - \tilde{\beta}_{i,j-1/2}
\end{equation}            

The remaining details of the multigrid solver are unchanged.  The boundary
conditions are implemented in the same way as done for Poisson's equation.
The only changes to the core solver are in the smoothing function, which
implements Eq.~\ref{eq:general_mg_smooth} and in the residual, which
constructs our operator as discretized in Eq.~\ref{eq:general_L}.

To test this solver out, we can define a test problem by picking functional
forms of $\alpha$, $\beta$, and $\gamma$, and a solution, $\phi$, with
desired boundary conditions and find the resulting $f$.  Here we solve
\begin{equation}
\alpha \phi + \nabla \cdot (\beta \nabla \phi) + \gamma \cdot \nabla \phi = f
\end{equation}
on $[0,1]\times[0,1]$ with homogeneous Dirichlet boundary conditions.  We
use
\begin{align}
\alpha &= 1 \\
\beta  &= \cos{(2 \pi x)} \cos{(2 \pi y)} + 2.0 \\
\gamma &= \sin(2\pi x) \hat{x} + \sin(2\pi y) \hat{y} \\
f      &= \left\{1-16 \pi^2 \left[\cos{(2 \pi x)} \cos{(2 \pi y)} + 1\right]
           + 2\pi \left[\cos{(2 \pi x)} + \cos{(2 \pi y)}\right]\right\} \sin{(2 \pi x)} \sin{(2 \pi y)}
\end{align}
which has the analytic solution
\begin{equation}
\phi = \sin{(2 \pi x)} \sin{(2 \pi y)}
\end{equation}
